# OhMyShokz PRD

## 1. 문서 정보
- 제품명: `OhMyShokz`
- 문서 버전: `v1.0`
- 작성일: `2026-02-20`
- 문서 목적: 개인용 macOS 앱의 요구사항(기능/품질/제약/확장 방향)을 명확히 정의

## 2. 제품 개요
`OhMyShokz`는 YouTube 링크 기반 오디오 추출과 Shokz(OpenSwim 계열) 파일 전송 워크플로를 단순화하는 macOS 데스크톱 앱이다.

핵심 사용자 문제:
- 수영용 MP3 파일을 만들기 위해 도구(`yt-dlp`, `ffmpeg`)를 따로 설치/실행하는 과정이 번거롭다.
- 여러 링크를 나중에 한 번에 변환하고 싶은데 관리가 어렵다.
- 기기 연결 후 파일 전송 상태를 한눈에 파악하기 어렵다.

핵심 해결 방식:
- 링크 입력 → 구간 지정 → MP3 생성을 앱 UI에서 처리
- 영상 저장 리스트(큐)로 변환 작업 저장/편집/일괄 실행
- 기기 폴더 탐지 및 복사 상태 관리

## 3. 목표 / 비목표
### 3.1 목표
- 개인 사용자가 클릭 기반으로 MP3를 생성할 수 있어야 한다.
- 임베드 가능 영상은 플레이어 기반 구간 선택이 가능해야 한다.
- 임베드 불가 영상도 구간 선택(바 UI)과 다운로드가 가능해야 한다.
- 저장 리스트(큐)를 영구 보관하고 항목별 편집/일괄 변환이 가능해야 한다.
- Shokz 후보 볼륨 탐지 및 파일 복사 상태(전송됨/미전송)를 표시해야 한다.

### 3.2 비목표
- 멀티 사용자 계정 시스템
- 클라우드 동기화
- 고급 오디오 편집(노멀라이즈, EQ, 페이드, 멀티트랙)
- iOS/Android 버전
- 디지털 저작권 우회 기능

## 4. 대상 사용자
- 주 사용자: 개인 Mac 사용자(Shokz OpenSwim 계열 사용)
- 사용 맥락:
  - 수영 전 재생 목록 준비
  - YouTube 단일 영상에서 구간 오디오 추출
  - 여러 링크를 모아 일괄 변환

## 5. 주요 사용자 시나리오
### 시나리오 A: 단일 영상 즉시 변환
1. 사용자가 YouTube 링크 입력
2. 영상 로드 후 시작/종료 시간 지정
3. 저장 폴더 선택
4. `MP3 생성` 클릭
5. 생성 파일이 목록에 나타남

### 시나리오 B: 임베드 불가 영상 처리
1. 링크 로드 시 임베드 오류(101/150) 발생
2. 앱이 fallback 바 UI 표시
3. 사용자가 바로 시작/종료 지정 후 적용
4. MP3 변환 실행

### 시나리오 C: 큐 저장 후 일괄 변환
1. 사용자가 여러 링크를 `리스트에 저장`
2. 항목별 파일명/시간 편집
3. `리스트 일괄 변환` 실행
4. 항목 상태가 `대기 → 진행중 → 완료/오류`로 갱신

### 시나리오 D: 기기 전송
1. `/Volumes` 기반 기기 후보 탐지 또는 수동 폴더 선택
2. 파일 목록에서 `기기로 복사`
3. 같은 파일명 존재 시 `전송됨` 표시

## 6. 기능 요구사항
### 6.1 링크/플레이어
- YouTube URL 파싱(`watch`, `youtu.be`, `shorts`)
- URL 파라미터 시간 자동 반영(`t`, `start`, `end`, `#t=`)
- 임베드 가능 시 영상 플레이어 표시
- 임베드 불가 시 fallback 패널 자동 노출

### 6.2 시간/구간 지정
- 입력 포맷: `HH:MM:SS` 또는 `MM:SS`
- 플레이어 현재 시각을 시작/종료로 입력 가능
- fallback range(시작/종료 슬라이더)로 시간 지정 가능
- 시작/종료 중 하나만 입력한 경우 오류 처리

### 6.3 도구 관리
- `ffmpeg`는 앱 번들 자원 활용
- `yt-dlp`는 앱 내 자동 설치 버튼 제공
- 다운로드 전 도구 상태 점검

### 6.4 다운로드
- 기본 단일 영상 처리 (`--no-playlist`)
- `watch?v=...&list=...` 입력 시 `v` 기준 단일 URL 정규화
- 구간 지정 시 `--download-sections` 적용
- 출력 파일명 사용자 지정 가능

### 6.5 영상 저장 리스트(큐)
- 항목 필드:
  - URL
  - title
  - outputName
  - startTime / endTime
  - status(`pending`, `running`, `done`, `error`)
  - message
- 항목 단위:
  - 편집 화면 로드
  - 개별 MP3 변환
  - 삭제
- 리스트 단위:
  - 일괄 변환(순차 실행)
  - 재시작 후 유지(localStorage)

### 6.6 파일 목록/기기 전송
- 로컬 MP3 목록 표시(최신순)
- 기기 볼륨 자동 탐지(`shokz`, `swim`, `openswim` 키워드)
- 파일 복사 기능
- 전송 상태 비교 시 파일명 Unicode 정규화(NFC) 적용

### 6.7 로그/상태
- 작업 로그 출력 영역 제공
- 사용자 상태 메시지 노출(준비/진행/완료/오류)

## 7. 비기능 요구사항
### 7.1 성능
- 일반 길이(3~6분) 영상 변환에서 사용자에게 진행 상태를 즉시 표시
- 큐 변환은 메인 UI가 멈추지 않고 상태 갱신 가능해야 함

### 7.2 신뢰성
- 개별 큐 항목 실패가 전체 앱 중단으로 이어지면 안 됨
- 실패 항목은 `error` 상태로 남기고 이후 항목 계속 진행

### 7.3 사용성
- 핵심 액션 버튼(`영상 불러오기`, `MP3 생성`, `리스트에 저장`, `리스트 일괄 변환`)이 명확해야 함
- 임베드 불가/도구 누락/시간 입력 오류 메시지가 구체적이어야 함

### 7.4 보안
- preload + contextIsolation 유지
- 렌더러에서 Node 직접 접근 금지, IPC 경유

## 8. 기술 아키텍처
- 런타임: Electron
- 메인 프로세스:
  - 정적 파일 로컬 HTTP 서빙
  - IPC 핸들러(도구 설치, 메타 조회, 다운로드, 파일 목록, 볼륨 탐지, 복사)
- 렌더러:
  - UI 상태 관리
  - YouTube IFrame API
  - 큐(localStorage) 관리
- 외부 도구:
  - `yt-dlp` (자동 설치)
  - `ffmpeg-static` (앱 번들)

## 9. 오류/예외 처리 정책
- 임베드 오류 101/150: fallback 바 UI 안내
- URL/ID 오류: 입력 교정 메시지
- 비공개/삭제 영상: 명시적 안내
- 도구 누락: 자동 설치 유도
- 플레이리스트 링크 입력: 단일 영상 처리

## 10. 성공 지표 (MVP)
- 단일 영상 변환 성공률
- 큐 일괄 변환 성공률
- 기기 복사 후 상태 표시 정확도
- 도구 설치 없이 앱 내부 가이드만으로 첫 변환까지 완료하는 비율

## 11. 제약 및 리스크
- YouTube 정책/포맷 변경 시 추출 실패 가능성
- 일부 영상은 지역/저작권 제한으로 다운로드 불가
- 네트워크 상태에 따라 ffmpeg/yt-dlp 후처리 오류 발생 가능

## 12. 향후 개선 로드맵
- 큐 필터/검색/정렬
- 실패 항목 일괄 재시도
- 파일명 템플릿 규칙(아티스트/제목/날짜)
- 전송 대상 폴더 프로필(기기별 preset)
- 다운로드 완료 알림/요약 리포트

## 13. 수용 기준 (Acceptance Criteria)
1. 사용자는 링크 1개로 MP3를 생성할 수 있어야 한다.
2. 임베드 불가 영상에서 fallback 바 구간 지정이 가능해야 한다.
3. `watch?v=...&list=...` 링크 입력 시 플레이리스트 전체가 아니라 단일 영상만 변환되어야 한다.
4. 사용자는 큐에 항목을 저장하고, 항목별 편집 후 일괄 변환할 수 있어야 한다.
5. 앱 재실행 후 큐가 유지되어야 한다.
6. 기기 복사 후 파일 상태가 `전송됨`으로 정확히 표시되어야 한다.
